record(longin,"$(P)$(D):SerialNo") {
    field(DESC, "Serial number")				     
    field(DTYP,"asynInt32")
    field(INP,"@asynMask($(PORT_RO) 6 32)INT32_BE")
    field(SCAN,"I/O Intr")
}

record(ai, "$(P)$(D):FlowRt") {
    field(DESC, "Gas flow rate")
    field(DTYP, "asynFloat64")
    field(INP,"@asyn($(PORT_RO) 0)FLOAT32_BE")
    field(LINR,"NO CONVERSION")
    field(ASLO,"$(ASLO)")
    field(HOPR,"400")
    field(LOPR,"0")
    field(PREC,"3")
#    field(EGU, "Nm³/h")
    field(EGU, "Stdl/h")
    field(SCAN,"I/O Intr")
    field(SMOO, "0.95")
    info (autosaveFields, "SMOO")
}

record(ai, "$(P)$(D):AccFlow") {
    field(DESC, "Accumulated gas flow")
    field(DTYP, "asynFloat64")
    field(INP, "@asyn($(PORT_RO) 2)FLOAT32_BE")
    field(LINR,"NO CONVERSION")
    field(ASLO,"$(ASLO)")
#    field(EGU, "Nm³")
    field(EGU, "Stdl")
    field(SCAN,"I/O Intr")
    field(PREC,"3")
}

record(ai, "$(P)$(D):T") {
    field(DESC, "Ambient temperature")
    field(DTYP, "asynFloat64")
    field(INP,"@asyn($(PORT_RO) 4)FLOAT32_BE")
    field(LINR,"NO CONVERSION")
    field(HOPR,"60.0")
    field(LOPR,"0")
    field(PREC,"2")
    field(EGU, "°C")
    field(SCAN,"I/O Intr")
    field(SMOO, "0.8")
    info (autosaveFields, "SMOO")
}

##################################################
#
# Commands

record(longout, "$(P)$(D):WriteEnable") {
    field(DESC, "Write enable")
    field(DTYP, "asynInt32")
    field(OUT,"@asyn($(PORT_WO) 219)INT32_BE")
    field(VAL, "9001")
}

record(longout, "$(P)$(D):AccFlow-Rst") {
    field(DESC, "Reset accumulated flow")
    field(DTYP, "asynInt32")
    field(OUT,"@asyn($(PORT_WO) 211)INT32_BE")
    field(VAL, "0x0003")
}

record(longout, "$(P)$(D):Reboot") {
    field(DESC, "Save settings and reboot")
    field(DTYP, "asynInt32")
    field(OUT,"@asyn($(PORT_WO) 500)INT32_BE")
    field(VAL, "500")
}

##################################################
#
# Help records

# A help record to check if data read from Modbus
# via Modbus gateway updates ok. This record is to be used
# for reporting an error when the Modbus data is read
# without any error but it's the old data, not the current one
#
record(calc, "$(P)$(D):sAlive") {
   field(DESC, "Live data OK")
   field(SCAN, "60 second")
   field(INPA, "$(P)$(D):AccFlow")
   field(INPB, "$(P)$(D):sAlive.LA")
   field(CALC, "((A-B)>0)?1:0")
   field(LOW, "0.5")
   field(PINI, "YES")
   field(LSV, "MAJOR")
}
